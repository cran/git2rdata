<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Thierry Onkelinx" />


<title>Suggested Workflow for Storing a Variable Set of Dataframes under Version Control</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Suggested Workflow for Storing a Variable Set of Dataframes under Version Control</h1>
<h4 class="author">Thierry Onkelinx</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette describes a suggested workflow for storing a snapshot of dataframes as git2rdata objects under version control. The workflow comes in two flavours:</p>
<ol style="list-style-type: decimal">
<li>A single repository holding both the data and the analysis code. The single repository set-up is simple. A single reference (e.g. commit) points to both the data and the code.</li>
<li>One repository holding the data and a second repository holding the code. The data and the code have an independent history under a two repository set-up. Documenting the analysis requires one reference to each repository. Such a set-up is useful for repeating the same analysis (stable code) on updated data.</li>
</ol>
<p>In this vignette we use a <code>git2r::repository()</code> object as the root. This adds git functionality to <code>write_vc()</code> and <code>read_vc()</code>, provided by the <a href="https://cran.r-project.org/package=git2r"><code>git2r</code></a> package. This allows to pull, stage, commit and push from within R.</p>
<p>Each commit in the data git repository describes a complete snapshot of the data at the time of the commit. The difference between two commits can consist of changes in existing git2rdata object (updated observations, new observations, deleted observations or updated metadata). Besides updating the existing git2rdata objects, we can also add new git2rdata objects or remove existing ones. We need to track such higher level addition and deletions as well.</p>
<p>We illustrate the workflow with a mock analysis on the <code>datasets::beaver1</code> and <code>datasets::beaver2</code> datasets.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>We start by initializing a git repository. <code>git2rdata</code> assumes that is already done. We’ll use the <code>git2r</code> functions to do so. We start by creating a local bare repository. In practice we will use a remote on an external server (GitHub, Gitlab, Bitbucket, …). The example below creates a local git repository with an upstream git repository. Any other workflow to create a similar structure is fine.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># initialize a bare git repo to be used as remote</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">remote &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="st">&quot;git2rdata-workflow-remote&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">remote &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(remote, <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Warning in normalizePath(remote, winslash = &quot;/&quot;): path[1]=&quot;/tmp/Rtmpv0LJli/</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; git2rdata-workflow-remote1c0b24f71392&quot;: Bestand of map bestaat niet</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">dir.create</span>(remote)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">git2r<span class="op">::</span><span class="kw">init</span>(remote, <span class="dt">bare =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; Head:     nothing commited (yet)</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co"># initialize a local git repo</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">path &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="st">&quot;git2rdata-workflow&quot;</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">path &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(path, <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; Warning in normalizePath(path, winslash = &quot;/&quot;): path[1]=&quot;/tmp/Rtmpv0LJli/</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; git2rdata-workflow1c0b1b99853d&quot;: Bestand of map bestaat niet</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw">dir.create</span>(path)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">init_repo &lt;-<span class="st"> </span>git2r<span class="op">::</span><span class="kw">clone</span>(remote, path, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">git2r<span class="op">::</span><span class="kw">config</span>(init_repo, <span class="dt">user.name =</span> <span class="st">&quot;me&quot;</span>, <span class="dt">user.email =</span> <span class="st">&quot;me@me.com&quot;</span>)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co"># add an initial commit with .gitignore file</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="kw">writeLines</span>(<span class="st">&quot;*extra*&quot;</span>, <span class="kw">file.path</span>(path, <span class="st">&quot;.gitignore&quot;</span>))</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">git2r<span class="op">::</span><span class="kw">add</span>(init_repo, <span class="st">&quot;.gitignore&quot;</span>, <span class="dt">force =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">git2r<span class="op">::</span><span class="kw">commit</span>(init_repo, <span class="dt">message =</span> <span class="st">&quot;Initial commit&quot;</span>)</a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt; [c515283] 2020-03-02: Initial commit</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co"># push initial commit to remote</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">git2r<span class="op">::</span><span class="kw">push</span>(init_repo, <span class="st">&quot;origin&quot;</span>, <span class="st">&quot;refs/heads/master&quot;</span>)</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="kw">rm</span>(init_repo)</a></code></pre></div>
</div>
<div id="structuring-git2rdata-objects-within-a-project" class="section level2">
<h2>Structuring Git2rdata Objects Within a Project</h2>
<p><code>git2rdata</code> imposes a minimal structure. Both the <code>.tsv</code> and the <code>.yml</code> file need to be in the same folder. That’s it. For the sake of simplicity, in this vignette we dump all git2rdata objects at the root of the repository.</p>
<p>This might not be good idea for real project. We recommend to use at least a different directory tree for each import script. This directory can go into the root of a data repository. It goes in the <code>data</code> directory in case of a data and code repository. Or the <code>inst</code> directory in case of an R package.</p>
<p>Your project might need a different directory structure. Feel free to choose the most relevant data structure for your project.</p>
</div>
<div id="storing-dataframes-ad-hoc-into-a-git-repository" class="section level2">
<h2>Storing Dataframes <em>ad Hoc</em> into a Git Repository</h2>
<div id="first-commit" class="section level3">
<h3>First Commit</h3>
<p>In the first commit we use <code>datasets::beaver1</code>. We connect to the git repository using <code>repository()</code>. Note that this assumes that <code>path</code> is an existing git repository. Now we can write the dataset as a git2rdata object in the repository. If the <code>root</code> argument of <code>write_vc()</code> is a <code>git_repository</code>, it gains two extra arguments: <code>stage</code> and <code>force</code>. Setting <code>stage = TRUE</code>, will automatically stage the files written by <code>write_vc()</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(git2rdata)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">repo &lt;-<span class="st"> </span><span class="kw">repository</span>(path)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">fn &lt;-<span class="st"> </span><span class="kw">write_vc</span>(beaver1, <span class="st">&quot;beaver&quot;</span>, repo, <span class="dt">sorting =</span> <span class="st">&quot;time&quot;</span>, <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>We can use <code>status()</code> to check that <code>write_vc()</code> wrote and staged the required files. Then we <code>commit()</code> the changes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">status</span>(repo)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; Staged changes:</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;  New:        beaver.tsv</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;  New:        beaver.yml</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">cm1 &lt;-<span class="st"> </span><span class="kw">commit</span>(repo, <span class="dt">message =</span> <span class="st">&quot;First commit&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">cat</span>(cm1<span class="op">$</span>message)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; First commit</span></a></code></pre></div>
</div>
<div id="second-commit" class="section level3">
<h3>Second Commit</h3>
<p>The second commit adds <code>beaver2</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">fn &lt;-<span class="st"> </span><span class="kw">write_vc</span>(beaver2, <span class="st">&quot;extra_beaver&quot;</span>, repo, <span class="dt">sorting =</span> <span class="st">&quot;time&quot;</span>, <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">status</span>(repo)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; working directory clean</span></a></code></pre></div>
<p>Notice that <code>extra_beaver</code> is not listed in the <code>status()</code>, although <code>write_vc()</code> wrote it to the repository. The reason is that we set a <code>.gitignore</code> which contains <code>&quot;*extra*</code>, so git ignores any git2rdata object with a name containing “extra”. We force git to stage it by setting <code>force = TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">status</span>(repo, <span class="dt">ignored =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; Ignored files:</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;  Ignored:    extra_beaver.tsv</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;  Ignored:    extra_beaver.yml</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">fn &lt;-<span class="st"> </span><span class="kw">write_vc</span>(beaver2, <span class="st">&quot;extra_beaver&quot;</span>, repo, <span class="dt">sorting =</span> <span class="st">&quot;time&quot;</span>, <span class="dt">stage =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">               <span class="dt">force =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="kw">status</span>(repo)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; Staged changes:</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  New:        extra_beaver.tsv</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;  New:        extra_beaver.yml</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">cm2 &lt;-<span class="st"> </span><span class="kw">commit</span>(repo, <span class="dt">message =</span> <span class="st">&quot;Second commit&quot;</span>)</a></code></pre></div>
</div>
<div id="third-commit" class="section level3">
<h3>Third Commit</h3>
<p>Now we decide that a single git2rdata object containing the data of both beavers is more relevant. We add an ID variable for each of the animals. This requires updating the <code>sorting</code> to avoid ties. And <code>strict = FALSE</code> to update the metadata. The “extra_beaver” git2rdata object is no longer needed so we remove it. We use <code>all = TRUE</code> to stage the removal of “extra_beaver” while committing the changes.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">beaver1<span class="op">$</span>beaver &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">beaver2<span class="op">$</span>beaver &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">beaver &lt;-<span class="st"> </span><span class="kw">rbind</span>(beaver1, beaver2)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">fn &lt;-<span class="st"> </span><span class="kw">write_vc</span>(beaver, <span class="st">&quot;beaver&quot;</span>, repo, <span class="dt">sorting =</span> <span class="kw">c</span>(<span class="st">&quot;beaver&quot;</span>, <span class="st">&quot;time&quot;</span>), </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">               <span class="dt">strict =</span> <span class="ot">FALSE</span>, <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; - The sorting variables changed.</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;     - Sorting for the new data: 'beaver', 'time'.</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;     - Sorting for the old data: 'time'.</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; - New data has a different number of variables.</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; - New variables: beaver.</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="kw">file.remove</span>(<span class="kw">list.files</span>(path, <span class="st">&quot;extra&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; [1] TRUE TRUE</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="kw">status</span>(repo)</a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt; Unstaged changes:</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt;  Deleted:    extra_beaver.tsv</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt;  Deleted:    extra_beaver.yml</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt; Staged changes:</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt;  Modified:   beaver.tsv</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt;  Modified:   beaver.yml</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">cm3 &lt;-<span class="st"> </span><span class="kw">commit</span>(repo, <span class="dt">message =</span> <span class="st">&quot;Third commit&quot;</span>, <span class="dt">all =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="kw">status</span>(repo)</a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="co">#&gt; working directory clean</span></a></code></pre></div>
</div>
</div>
<div id="scripted-workflow-for-storing-dataframes" class="section level2">
<h2>Scripted Workflow for Storing Dataframes</h2>
<p>We strongly recommend to add git2rdata object through an import script instead of adding them <a href="#storing-dataframes-ad-hoc-into-a-git-repository"><em>ad hoc</em></a>. Store this script in the (analysis) repository. It documents the creation of the git2rdata objects. Rerun this script whenever updated data becomes available.</p>
<p>Old versions of the import script and the associated git2rdata remain available through the version control history. Remove obsolete git2rdata objects from the import script. This keeps both the import script and the working directory tidy and minimal.</p>
<p>Basically, the import script should create all git2rdata objects within a given directory tree. This gives the advantage that we start the import script by clearing any existing git2rdata object in this directory. If the import script no longer creates a git2rdata object, it gets removed without the need to track what git2rdata objects existed in the previous version.</p>
<p>The brute force method of removing all files or all <code>.tsv</code> / <code>.yml</code> pairs is not a good idea. This removes the existing metadata which we need for efficient storage (see <code>vignette(&quot;efficiency&quot;, package = &quot;git2rdata&quot;)</code>). A better solution is to use <code>rm_data()</code> on the directory at the start of the import script. This removes all <code>.tsv</code> files which have valid metadata. The existing metadata remains untouched at this point.</p>
<p>Then write all git2rdata objects and stage them. Unchanged objects will not lead to a diff, even if we first deleted and then recreated them. The script won’t recreate the <code>.tsv</code> file of obsolete git2rdata objects. Use <code>prune_meta()</code> to remove any leftover metadata files.</p>
<p>Commit and push the changes at the end of the script.</p>
<p>Below is an example script recreating the “beaver” git2rdata object from the <a href="#third-commit">third commit</a>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># load package</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">library</span>(git2rdata)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co"># step 1: setup the repository and data path</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">repo &lt;-<span class="st"> </span><span class="kw">repository</span>(<span class="st">&quot;.&quot;</span>)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">data_path &lt;-<span class="st"> &quot;data/beaver&quot;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co"># step 1b: sync the repository with the remote</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="kw">pull</span>(<span class="dt">repo =</span> repo)</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co"># step 2: remove all existing data files</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw">rm_data</span>(<span class="dt">root =</span> repo, <span class="dt">path =</span> data_path, <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co"># step 3: write all relevant git2rdata objects to the data path</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">beaver1<span class="op">$</span>beaver &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">beaver2<span class="op">$</span>beaver &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">body_temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(beaver1, beaver2)</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">fn &lt;-<span class="st"> </span><span class="kw">write_vc</span>(<span class="dt">x =</span> body_temp, <span class="dt">file =</span> <span class="kw">file.path</span>(data_path, <span class="st">&quot;body_temperature&quot;</span>), </a>
<a class="sourceLine" id="cb7-16" data-line-number="16">               <span class="dt">root =</span> repo, <span class="dt">sorting =</span> <span class="kw">c</span>(<span class="st">&quot;beaver&quot;</span>, <span class="st">&quot;time&quot;</span>), <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-17" data-line-number="17"></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co"># step 4: remove any dangling metadata files</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="kw">prune_meta</span>(<span class="dt">root =</span> repo, <span class="dt">path =</span> data_path, <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-20" data-line-number="20"></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co"># step 5: commit the changes</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22">cm &lt;-<span class="st"> </span><span class="kw">commit</span>(<span class="dt">repo =</span> repo, <span class="dt">message =</span> <span class="st">&quot;import&quot;</span>)</a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co"># step 5b: sync the repository with the remote</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="kw">push</span>(<span class="dt">repo =</span> repo)</a></code></pre></div>
</div>
<div id="r-package-workflow-for-storing-dataframes" class="section level2">
<h2>R Package Workflow for Storing Dataframes</h2>
<p>We recommend a two repository set-up in case of recurring analyses. These are relative stable analyses which have to run with some frequency on updated data (e.g. once a month). That makes it worthwhile to convert the analyses into an R package. Split long scripts into a set of shorter functions which are much easier to document and maintain. An R package offers lots of <a href="http://r-pkgs.had.co.nz/check.html">functionality</a> out of the box to check the quality of your code.</p>
<p>The example below converts the import script above into a function. We illustrate how you can use Roxygen2 (see <code>vignette(&quot;roxygen2&quot;, package = &quot;roxygen2&quot;)</code>) tags to document the function and to list its dependencies. Note that we added <code>session = TRUE</code> to <code>commit()</code>. This will append the <code>sessionInfo()</code> at the time of the commit to the commit message. Thus documenting all loaded R packages and their version. This documents to code used to create the git2rdata object since your analysis code resides in a dedicated package with its own version number. We strongly recommend to run the import from a fresh R session. Then the <code>sessionInfo()</code> at commit time contains those packages with are strictly required for the import. Consider running the import from the command line. e.g. <code>Rscript -e 'mypackage::import_body_temp(&quot;path/to/root&quot;)'</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#' Import the beaver body temperature data</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#' @param path the root of the git repository</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#' @importFrom git2rdata repository pull rm_data write_vc prune_meta commit push</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#' @export</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">import_body_temp &lt;-<span class="st"> </span><span class="cf">function</span>(path) {</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="co"># step 1: setup the repository and data path</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  repo &lt;-<span class="st"> </span><span class="kw">repository</span>(path)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  data_path &lt;-<span class="st"> &quot;data/beaver&quot;</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">  <span class="co"># step 1b: sync the repository with the remote</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">  <span class="kw">pull</span>(<span class="dt">repo =</span> repo)</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">  <span class="co"># step 2: remove all existing data files</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12">  <span class="kw">rm_data</span>(<span class="dt">root =</span> repo, <span class="dt">path =</span> data_path, <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb8-14" data-line-number="14">  <span class="co"># step 3: write all relevant git2rdata objects to the data path</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">  beaver1<span class="op">$</span>beaver &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  beaver2<span class="op">$</span>beaver &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17">  body_temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(beaver1, beaver2)</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">  fn &lt;-<span class="st"> </span><span class="kw">write_vc</span>(<span class="dt">x =</span> body_temp, <span class="dt">file =</span> <span class="kw">file.path</span>(data_path, <span class="st">&quot;body_temperature&quot;</span>), </a>
<a class="sourceLine" id="cb8-19" data-line-number="19">                 <span class="dt">root =</span> repo, <span class="dt">sorting =</span> <span class="kw">c</span>(<span class="st">&quot;beaver&quot;</span>, <span class="st">&quot;time&quot;</span>), <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb8-21" data-line-number="21">  <span class="co"># step 4: remove any dangling metadata files</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22">  <span class="kw">prune_meta</span>(<span class="dt">root =</span> repo, <span class="dt">path =</span> data_path, <span class="dt">stage =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb8-24" data-line-number="24">  <span class="co"># step 5: commit the changes</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25">  cm &lt;-<span class="st"> </span><span class="kw">commit</span>(<span class="dt">repo =</span> repo, <span class="dt">message =</span> <span class="st">&quot;import&quot;</span>, <span class="dt">session =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-26" data-line-number="26">  <span class="co"># step 5b: sync the repository with the remote</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27">  <span class="kw">push</span>(<span class="dt">repo =</span> repo)</a>
<a class="sourceLine" id="cb8-28" data-line-number="28">}</a></code></pre></div>
</div>
<div id="analysis-workflow-with-reproducible-data" class="section level2">
<h2>Analysis Workflow with Reproducible Data</h2>
<p>The example below is a small trivial example of a standardized analysis in which documents the source of the data by describing the name of the data, the repository URL and the commit. We can use this information when reporting the results. This makes the data underlying the results traceable.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">analysis &lt;-<span class="st"> </span><span class="cf">function</span>(ds_name, repo) {</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  ds &lt;-<span class="st"> </span><span class="kw">read_vc</span>(ds_name, repo)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="dt">dataset =</span> ds_name,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="dt">repository =</span> git2r<span class="op">::</span><span class="kw">remote_url</span>(repo),</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    <span class="dt">commit =</span> <span class="kw">recent_commit</span>(ds_name, repo, <span class="dt">data =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="dt">model =</span> <span class="kw">lm</span>(temp <span class="op">~</span><span class="st"> </span>activ, <span class="dt">data =</span> ds)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">report &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  knitr<span class="op">::</span><span class="kw">kable</span>(</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    <span class="kw">coef</span>(<span class="kw">summary</span>(x<span class="op">$</span>model)),</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    <span class="dt">caption =</span> <span class="kw">sprintf</span>(<span class="st">&quot;**dataset:** %s  </span><span class="ch">\n</span><span class="st">**commit:** %s  </span><span class="ch">\n</span><span class="st">**repository:** %s&quot;</span>, </a>
<a class="sourceLine" id="cb9-14" data-line-number="14">                      x<span class="op">$</span>dataset, x<span class="op">$</span>commit<span class="op">$</span>commit, x<span class="op">$</span>repository)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">  )</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">}</a></code></pre></div>
<p>In this case we can run every analysis by looping over the list of datasets in the repository.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">repo &lt;-<span class="st"> </span><span class="kw">repository</span>(path)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">current &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list_data</span>(repo), analysis, <span class="dt">repo =</span> repo)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">names</span>(current) &lt;-<span class="st"> </span><span class="kw">list_data</span>(repo)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">result &lt;-<span class="st"> </span><span class="kw">lapply</span>(current, report)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">junk &lt;-<span class="st"> </span><span class="kw">lapply</span>(result, print)</a></code></pre></div>
<table>
<caption><strong>dataset:</strong> beaver<br />
<strong>commit:</strong> 970f2e9582c87c4a9b599dbad5a621fb343b694a<br />
<strong>repository:</strong> /tmp/Rtmpv0LJli/git2rdata-workflow-remote1c0b24f71392</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">36.9084247</td>
<td align="right">0.0198546</td>
<td align="right">1858.93938</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>activ</td>
<td align="right">0.9346636</td>
<td align="right">0.0352219</td>
<td align="right">26.53644</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The example below does the same thing for the first and second commit.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># checkout first commit</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">git2r<span class="op">::</span><span class="kw">checkout</span>(cm1)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># do analysis</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">previous &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list_data</span>(repo), analysis, <span class="dt">repo =</span> repo)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw">names</span>(previous) &lt;-<span class="st"> </span><span class="kw">list_data</span>(repo)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">result &lt;-<span class="st"> </span><span class="kw">lapply</span>(previous, report)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">junk &lt;-<span class="st"> </span><span class="kw">lapply</span>(result, print)</a></code></pre></div>
<table>
<caption><strong>dataset:</strong> beaver<br />
<strong>commit:</strong> 2751fe25c082a9e337e6e7733a4b805bdf972044<br />
<strong>repository:</strong> /tmp/Rtmpv0LJli/git2rdata-workflow-remote1c0b24f71392</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">36.8421296</td>
<td align="right">0.0167694</td>
<td align="right">2196.987569</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td>activ</td>
<td align="right">0.3812037</td>
<td align="right">0.0730961</td>
<td align="right">5.215107</td>
<td align="right">8e-07</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># checkout second commit</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">git2r<span class="op">::</span><span class="kw">checkout</span>(cm2)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># do analysis</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">previous &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list_data</span>(repo), analysis, <span class="dt">repo =</span> repo)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw">names</span>(previous) &lt;-<span class="st"> </span><span class="kw">list_data</span>(repo)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">result &lt;-<span class="st"> </span><span class="kw">lapply</span>(previous, report)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">junk &lt;-<span class="st"> </span><span class="kw">lapply</span>(result, print)</a></code></pre></div>
<table>
<caption><strong>dataset:</strong> beaver<br />
<strong>commit:</strong> 2751fe25c082a9e337e6e7733a4b805bdf972044<br />
<strong>repository:</strong> /tmp/Rtmpv0LJli/git2rdata-workflow-remote1c0b24f71392</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">36.8421296</td>
<td align="right">0.0167694</td>
<td align="right">2196.987569</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td>activ</td>
<td align="right">0.3812037</td>
<td align="right">0.0730961</td>
<td align="right">5.215107</td>
<td align="right">8e-07</td>
</tr>
</tbody>
</table>
<table>
<caption><strong>dataset:</strong> extra_beaver<br />
<strong>commit:</strong> d885ff8ff1ab42269896c5c604cef5ab4c9d14ef<br />
<strong>repository:</strong> /tmp/Rtmpv0LJli/git2rdata-workflow-remote1c0b24f71392</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">37.0968421</td>
<td align="right">0.0345624</td>
<td align="right">1073.32955</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>activ</td>
<td align="right">0.8062224</td>
<td align="right">0.0438943</td>
<td align="right">18.36736</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>If you inspect the reported results you’ll notice that all the output (coefficients and commit hash) for “beaver” object is identical for the first and second commit. This makes sense since the “beaver” object didn’t change during the second commit. The output for the current (third) commit is different because the dataset changed.</p>
<div id="long-running-analysis" class="section level3">
<h3>Long running analysis</h3>
<p>Imagine the case where an individual analysis takes a while to run. We store the most recent version of each analysis and add the information from <code>recent_commit()</code>. When preparing the analysis, you can run <code>recent_commit()</code> again on the dataset and compare the commit hash with that one of the available analysis. If the commit hashes match, then the data hasn’t changed. Then there is no need to rerun the analysis<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, saving valuable computing resources and time.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>assuming the code for running the analysis didn’t change.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
